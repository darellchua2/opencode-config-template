# Project AGENTS.md

## Team Rules

### Coding Standards

#### Python
- Follow PEP 8 style guide
- Use 4 spaces for indentation (no tabs)
- Maximum line length: 100 characters
- Use type hints for function signatures
- Follow docstring conventions (PEP 257)
- Prefer f-strings for string formatting

#### JavaScript/TypeScript
- Use 2 spaces for indentation (no tabs)
- Maximum line length: 100 characters
- Use semicolons consistently
- Prefer const over let over var
- Use arrow functions for callbacks
- Follow ESLint configuration

#### General
- Write clear, descriptive variable and function names
- Keep functions small and focused (max 20 lines)
- Comment complex logic only
- Avoid deeply nested code (max 3 levels)

### Testing Requirements

#### Test Coverage
- All code must have unit tests
- Minimum 80% code coverage required
- Test all public APIs
- Test edge cases and error conditions

#### Test Types
- Unit tests for individual functions
- Integration tests for component interactions
- End-to-end tests for critical workflows

#### Test Quality
- Tests should be independent and reproducible
- Use descriptive test names
- Test both happy path and error scenarios
- Mock external dependencies appropriately

### Documentation Standards

#### Code Documentation
- All public APIs must have docstrings
- Docstrings should follow language-specific standards:
  - Python: Google style or NumPy style
  - TypeScript/JavaScript: JSDoc format
  - Java: Javadoc format
  - C#: XML documentation comments

#### README.md
- Update README.md for new features
- Include installation instructions
- Provide usage examples
- Document configuration options
- Keep README.md up-to-date

#### Inline Comments
- Use comments to explain WHY, not WHAT
- Comment complex algorithms or business logic
- Avoid obvious comments
- Keep comments short and clear

### Review Process

#### Code Review Checklist
- [ ] Code follows project conventions
- [ ] Tests are included and passing
- [ ] Documentation is updated
- [ ] No obvious bugs or issues
- [ ] Performance considerations addressed
- [ ] Security best practices followed

#### Pull Request Requirements
- All PRs require at least one approval
- PR must pass CI/CD checks
- Review comments must be addressed
- PR description must include:
  - Summary of changes
  - Related issue number
  - Testing performed
  - Breaking changes (if any)

### Deployment Strategy

#### Versioning
- Use semantic versioning (MAJOR.MINOR.PATCH)
- Tag releases with version numbers
- Maintain CHANGELOG.md

#### Branching Strategy
- Use feature branches from tickets
- Merge through pull requests only
- Protect main/master branch
- Require branch protection rules

#### Deployment Process
- Deploy from protected branches
- Run automated tests before deployment
- Use feature flags for gradual rollout
- Monitor deployments and rollback if needed

## Default Agent Mappings

### Task Type → Agent

| Task Type | Default Agent | Description |
|-----------|---------------|-------------|
| Planning and strategy | `plan-with-skills` | Analyze requirements, create plans |
| Implementation | `build-with-skills` | Write code, implement features |
| Code linting | `linting-subagent` | Enforce code quality standards |
| Testing | `testing-subagent` | Generate and run tests |
| Git operations | `git-workflow-subagent` | Branch, commit, PR, issue management |
| Documentation | `documentation-subagent` | Generate docstrings, update docs |
| Infrastructure | `opentofu-explorer-subagent` | Terraform/ToFu infrastructure |
| Workflows | `workflow-subagent` | PR workflows, automation |
| Image analysis | `image-analyzer` | Analyze screenshots, UI to code |
| Diagram creation | `diagram-creator` | Create architecture diagrams |
| Codebase exploration | `explore` | Search and understand codebase |

## Subagent Routing Rules

### Automatic Routing Patterns

#### Code Quality Tasks
Pattern → Subagent:
- `lint*`, `fix*style*`, `format*`, `quality*`, `clean*` → `linting-subagent`
- Examples: "lint the code", "fix style issues", "format python files"

#### Testing Tasks
Pattern → Subagent:
- `test*`, `spec*`, `coverage*`, `assert*`, `unit*`, `integration*` → `testing-subagent`
- Examples: "write tests", "check coverage", "test the function"

#### Git/JIRA Tasks
Pattern → Subagent:
- `branch*`, `commit*`, `pr*`, `issue*`, `merge*`, `checkout*` → `git-workflow-subagent`
- Examples: "create branch", "make commit", "create PR", "update issue"

#### Documentation Tasks
Pattern → Subagent:
- `doc*`, `readme*`, `comment*`, `example*`, `tutorial*`, `guide*` → `documentation-subagent`
- Examples: "update documentation", "write docstrings", "update README"

#### Infrastructure Tasks
Pattern → Subagent:
- `infra*`, `terraform*`, `tofu*`, `k8s*`, `aws*`, `kubernetes*`, `cloud*`, `ec2*`, `s3*`, `eks*` → `opentofu-explorer-subagent`
- Examples: "deploy to AWS", "setup Kubernetes", "Terraform configuration"

#### Workflow Tasks
Pattern → Subagent:
- `workflow*`, `automation*`, `pipeline*`, `ci*`, `cd*` → `workflow-subagent`
- Examples: "setup CI/CD", "automate workflow", "create pipeline"

### Specialized Routing

#### Image Analysis
- `screenshot*`, `image*`, `ui*design*`, `mockup*` → `image-analyzer`
- Examples: "analyze screenshot", "convert UI to code"

#### Diagram Creation
- `diagram*`, `architecture*`, `flowchart*`, `uml*`, `sequence*` → `diagram-creator`
- Examples: "create architecture diagram", "draw flowchart"

#### Codebase Exploration
- `find*`, `search*`, `explore*`, `locate*` → `explore`
- Examples: "find all files", "search for function", "explore codebase"

### Routing Priority

1. **Exact pattern match** - highest priority
2. **Keyword match** - medium priority
3. **Task type inference** - lower priority
4. **Default to build-with-skills** - fallback

## Project-Specific Instructions

### Workflow Preferences

#### Development Workflow
1. Always create PLAN.md before implementation
2. Use semantic branches from tickets (issue-number or feature-name)
3. Write tests before or alongside code (TDD preferred)
4. Run linting and fix issues before committing
5. Update related issues with progress
6. Create pull requests for review
7. Ensure all checks pass before merging

#### Commit Message Format
- Follow Conventional Commits specification
- Format: `<type>(<scope>): <subject>`
- Types: feat, fix, docs, style, refactor, test, chore
- Examples:
  - `feat(auth): add JWT token validation`
  - `fix(api): handle null response from user endpoint`
  - `docs(readme): update installation instructions`

#### Branch Naming Convention
- Feature branches: `feature/<issue-number>-<short-description>`
- Bugfix branches: `fix/<issue-number>-<short-description>`
- Hotfix branches: `hotfix/<issue-number>-<short-description>`
- Examples:
  - `feature/123-user-authentication`
  - `fix/456-memory-leak`
  - `hotfix/789-critical-security`

### Code Review Guidelines

#### What to Review
- Code correctness and logic
- Adherence to project conventions
- Test coverage and quality
- Documentation completeness
- Performance implications
- Security considerations

#### How to Review
- Provide constructive feedback
- Explain reasoning for changes
- Suggest alternatives when appropriate
- Approve when satisfied with changes
- Request changes only when necessary

### Testing Strategy

#### Test Pyramid
- **Unit tests**: Many small, fast tests (70%)
- **Integration tests**: Medium tests for interactions (20%)
- **End-to-end tests**: Few critical path tests (10%)

#### Test Organization
- Mirror source code structure
- Use descriptive test names
- Group related tests
- Use test fixtures for setup
- Mock external dependencies

#### Test Execution
- Run tests locally before pushing
- Use CI/CD for automated testing
- Monitor test coverage trends
- Fix failing tests immediately

### Deployment Guidelines

#### Pre-Deployment Checklist
- [ ] All tests passing
- [ ] Code reviewed and approved
- [ ] Documentation updated
- [ ] Changelog updated
- [ ] Version bumped
- [ ] Release notes prepared
- [ ] Backup created (if needed)

#### Deployment Process
1. Create release branch from main
2. Bump version number
3. Update CHANGELOG.md
4. Create Git tag
5. Deploy to staging environment
6. Run smoke tests
7. Deploy to production
8. Monitor for issues
9. Prepare rollback if needed

## Environment Configuration

### Development Environment
- Use local development tools
- Enable debug logging
- Use mock services for external APIs
- Hot reload enabled
- Fast feedback loop

### Staging Environment
- Mirror production configuration
- Use real external services (test accounts)
- Enable detailed logging
- Performance monitoring enabled
- Feature flags for testing

### Production Environment
- Optimized configuration
- Minimal logging (error and warn only)
- Production external services
- Caching enabled
- Load balancing enabled

## Security Guidelines

#### Authentication & Authorization
- Use secure authentication mechanisms (JWT, OAuth)
- Implement proper authorization checks
- Never expose sensitive data in logs
- Use environment variables for secrets
- Rotate API keys regularly

#### Data Protection
- Encrypt sensitive data at rest
- Use HTTPS for all communications
- Validate and sanitize user inputs
- Implement rate limiting
- Follow GDPR/CCPA compliance if applicable

#### Code Security
- Keep dependencies up-to-date
- Use security scanning tools
- Conduct regular security audits
- Follow OWASP guidelines
- Report security vulnerabilities responsibly

## Performance Guidelines

#### Optimization Strategies
- Minimize database queries
- Use caching where appropriate
- Optimize images and assets
- Use lazy loading
- Implement pagination for large datasets

#### Monitoring
- Track response times
- Monitor error rates
- Set up alerts for anomalies
- Profile slow endpoints
- Optimize bottlenecks

## Accessibility Guidelines

#### General Standards
- Follow WCAG 2.1 AA guidelines
- Ensure keyboard navigation
- Provide alt text for images
- Use semantic HTML
- Ensure sufficient color contrast
- Support screen readers

#### Testing
- Test with keyboard only
- Test with screen readers
- Test with color blindness simulators
- Test with different screen sizes
- Test with different browsers

---

*This file is part of the OpenCode configuration system. See config.json for agent definitions and global AGENTS.md (~/.config/opencode/AGENTS.md) for personal preferences.*
